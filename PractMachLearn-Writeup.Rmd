---
title: "Practical Machine Learning - Assignment"
output: html_document
---
````{r,global_options,warning=FALSE, message=FALSE}
```

This project will take the Weight Lifting Exercise data set and attempt to create a predictive model for the six people performing exercies both correctly and incorrectly. Each person was wearing an activity monitor to capture their activity. The raw activity data will be cleaned, parsed and then used in a predictive model.
The initial training set: https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv.
And the initial testing set: https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv. 

#Data processing and analysis
Load the initial data and the required libraries. Take a quick look at the data.
```{r,getdata,warning=FALSE, message=FALSE}
setwd("~/coursera/datasci-predmachlearn")
library(corrplot) ;library(caret) ;library(kernlab);library(randomForest)
library(doMC);registerDoMC(cores=2);registerDoMC(2)
testingorig<-read.csv("./pml-testing.csv")
trainingorig<-read.csv("./pml-training.csv")

```

```{r,getdata-result, }
length(trainingorig);#str(trainingorig)
```
Start with simple exploratory data analysis (EDA) to look at the data. For the model we will be attempting to reduce the number of variables so will be tracking that through the cleaning and parsing process.

The initial look at the data shows there are a large number of columns with missing values. The first step is eliminating those columns from the data. There are also control columns of data that need to be removed
```{r, clean}
missing<-colSums(is.na(trainingorig))
missing_log<-(missing==0)
trainingFew<-trainingorig[,missing_log==T]
length(trainingFew)
testingFew<-testingorig[,missing_log==T]
#get rid of more columns
delCol<-grepl("X|user_name|timestamp|new_window|num_window",colnames(trainingFew))
trainingFinal<-trainingFew[,!delCol]
testingFinal<-testingFew[,!delCol]
```
It is now time to separate the data into a training and testing set. Although there was a given testing set, that set does not have the response variable, so it can not be used for the actual testing of our model.
```{r, createtrain}
set.seed(12345)
# start with a very small set (p=.1 for quick look, then set to .7 for final runs)
inTrain<-createDataPartition(y=trainingFinal$classe,p=.1,list=FALSE)
training<-trainingFinal[inTrain,]
testing<-testingFinal[-inTrain,]
length(trainingFinal);# str(training)
```
Now that we have a smaller set, we can use Principal Component Analysis (PCA) to remove more columns from the data set. This only works with numeric or integer variables so we will remove the factor variables from this test. We will create a quick view of the correlations, identify those which are correlated and then remove those columns.

```{r, PCA}
# correlated predictors - take out all of the factors since correlations only work with int or num
pred.corr<-cor(training[,c(-5:-13,-36:-41,-45:-53,-67:-75,-86)])
str(pred.corr)
#head(pred.corr,1)
which((pred.corr>0.95) & pred.corr!=1,useNames=TRUE,arr.ind=TRUE)
which((abs(pred.corr)>.95) & pred.corr!=1,useNames=TRUE,arr.ind=TRUE)
# check
pred.corr["roll_belt","total_accel_belt"]
pred.corr["roll_belt","accel_belt_z"]
pred.corr["pitch_belt","accel_belt_x"]
pred.corr["gyros_dumbbell_z","gyros_dumbbell_x"]
pred.corr["gyros_dumbbell_z","gyros_forearm_z"]
# remove all of the correlated items
delCol<-grepl("total_accel_belt|accel_belt_z|accel_belt_x|gyros_dumbbell_x|gyros_forearm_z",colnames(trainingFinal))
trainingLast<-trainingFinal[,!delCol]
testingLast<-testingFinal[,!delCol]
length(trainingLast)# give a final counth of variables
```
# Model building

````{r, model}
#model1<-train(classe ~ ., method="rpart",data=trainingLast)
#model2<train(classe ~ ., method="knn",data=trainingLast)

````

